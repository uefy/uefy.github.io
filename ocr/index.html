<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OCR - Image to Text</title>
  <link rel="icon" href="favicon.png" type="image/png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- jsPDF (PDF download) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body { background: #0f0f0f; }
    #preview { max-width: 100%; display:none; border-radius: 12px; }
    #pasteArea:hover { border-color: #777; }
  </style>
</head>
<body class="text-gray-200">

  <div class="max-w-2xl mx-auto mt-10 p-6 bg-[#1c1c1c] rounded-2xl shadow-xl">

    <h1 class="text-3xl font-bold mb-6 text-center">ðŸ“„ OCR - Image to Text</h1>

    <!-- File Upload -->
    <input type="file" id="fileInput"
      class="w-full p-3 bg-[#2b2b2b] border border-gray-700 rounded-xl mb-4">

    <!-- Clipboard Area -->
    <div id="pasteArea"
      class="p-6 text-center border-2 border-dashed border-gray-500 rounded-xl cursor-pointer">
      ðŸ“‹ Click here and press <b>Ctrl + V</b> to paste a screenshot
    </div>

    <img id="preview" class="mt-5 shadow-lg">

    <!-- Progress -->
    <div id="progress" class="text-center mt-3 text-gray-300"></div>

    <h2 class="text-xl font-semibold mt-6 mb-2">Text Output:</h2>

    <!-- Textarea -->
    <textarea id="output"
      class="w-full p-4 bg-[#2b2b2b] rounded-xl min-h-[160px] outline-none"></textarea>

    <!-- Buttons -->
    <div class="grid grid-cols-3 gap-3 mt-4">

      <button id="copyBtn"
        class="bg-blue-600 hover:bg-blue-700 transition p-3 rounded-xl font-semibold">
        ðŸ“‹ Copy
      </button>

      <button id="downloadTxt"
        class="bg-green-600 hover:bg-green-700 transition p-3 rounded-xl font-semibold">
        â¬‡ Download TXT
      </button>

      <button id="downloadPdf"
        class="bg-red-600 hover:bg-red-700 transition p-3 rounded-xl font-semibold">
        â¬‡ Download PDF
      </button>

    </div>

    <!-- History -->
    <h2 class="text-xl font-semibold mt-8">ðŸ“š OCR History</h2>

    <div id="history" class="mt-3 space-y-3"></div>

    <button id="clearHistory"
      class="mt-4 w-full bg-gray-700 hover:bg-gray-600 p-3 rounded-xl">
      ðŸ—‘ Clear History
    </button>

  </div>

  <!-- Tesseract -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <script>
    const fileInput = document.getElementById('fileInput');
    const pasteArea = document.getElementById('pasteArea');
    const preview = document.getElementById('preview');
    const output = document.getElementById('output');
    const progress = document.getElementById('progress');

    const copyBtn = document.getElementById('copyBtn');
    const downloadTxt = document.getElementById('downloadTxt');
    const downloadPdf = document.getElementById('downloadPdf');

    const historyDiv = document.getElementById('history');
    const clearHistory = document.getElementById('clearHistory');

    // Load history from LocalStorage
    function loadHistory() {
      historyDiv.innerHTML = "";
      const list = JSON.parse(localStorage.getItem("ocrHistory") || "[]");

      list.forEach((item, i) => {
        const box = document.createElement("div");
        box.className = "bg-[#2b2b2b] p-3 rounded-xl cursor-pointer hover:bg-[#333] transition";
        box.innerText = `ðŸ“Œ Record #${i + 1}\n\n${item.substring(0,200)}...`;
        box.onclick = () => output.value = item;
        historyDiv.appendChild(box);
      });
    }
    loadHistory();

    function saveToHistory(text) {
      let list = JSON.parse(localStorage.getItem("ocrHistory") || "[]");
      list.unshift(text);
      localStorage.setItem("ocrHistory", JSON.stringify(list));
      loadHistory();
    }

    function processImage(file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';

      output.value = "Processing...";
      progress.textContent = "Preparing...";

      Tesseract.recognize(file, 'eng', {   // OCR language set to English
        logger: m => {
          if (m.status === "recognizing text") {
            progress.textContent = "Loading: % " + Math.floor(m.progress * 100);
          }
        }
      }).then(res => {
        output.value = res.data.text;
        progress.textContent = "âœ” Completed";
        saveToHistory(res.data.text);
      });
    }

    fileInput.addEventListener('change', () => {
      if (fileInput.files[0]) processImage(fileInput.files[0]);
    });

    pasteArea.addEventListener('paste', e => {
      for (let item of e.clipboardData.items) {
        if (item.type.startsWith("image/")) {
          processImage(item.getAsFile());
          return;
        }
      }
      alert("No image found in clipboard!");
    });

    // Copy
    copyBtn.addEventListener('click', () => {
      navigator.clipboard.writeText(output.value);
      copyBtn.innerText = "âœ” Copied!";
      setTimeout(() => copyBtn.innerText = "ðŸ“‹ Copy", 1500);
    });

    // Download TXT
    downloadTxt.addEventListener('click', () => {
      const blob = new Blob([output.value], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "ocr.txt";
      a.click();
    });

    // Download PDF
    downloadPdf.addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.text(output.value, 10, 10);
      pdf.save("ocr.pdf");
    });

    // Clear History
    clearHistory.addEventListener('click', () => {
      if (confirm("Clear all history?")) {
        localStorage.removeItem("ocrHistory");
        loadHistory();
      }
    });
  </script>

</body>
</html>
